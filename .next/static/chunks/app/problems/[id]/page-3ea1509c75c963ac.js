(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[877],{7919:function(e,l,n){Promise.resolve().then(n.bind(n,8390))},8390:function(e,l,n){"use strict";n.r(l),n.d(l,{default:function(){return i}});var s=n(7437),t=n(2265),a=n(3323);function i(e){var l,n;let{params:i}=e,o=(0,a.Z)(),[r,c]=(0,t.useState)(null),[u,d]=(0,t.useState)([]),[m,h]=(0,t.useState)(null),[v,p]=(0,t.useState)(!1),[b,j]=(0,t.useState)(""),[x,f]=(0,t.useState)(0),y=async()=>{if(!o)return;let e=await fetch("/api/problems/".concat(i.id,"?userKey=").concat(o)),l=null;try{l=await e.json()}catch(e){l=null}if(e.ok&&l){var n,s,t;c(l.problem),d(l.tasks||[]),j((null===(n=l.problem)||void 0===n?void 0:n.title)||""),f((null===(t=l.problem)||void 0===t?void 0:null===(s=t.params)||void 0===s?void 0:s.availableMinutes)||0),h(null)}else h("Could not load problem.")},g=(e,l,n)=>{d(s=>s.map((s,t)=>t===e?{...s,[l]:n}:s))},N=e=>{d(l=>l.filter((l,n)=>n!==e))},k=async()=>{let e=u.map(e=>({label:String(e.label||"").trim(),duration_min:Number(e.duration_min||0),must:!!e.must})).filter(e=>e.label&&e.duration_min>0),l=await fetch("/api/problems/".concat(i.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({userKey:o,title:b,availableMinutes:x,tasks:e})}),n=null;try{n=await l.json()}catch(e){n=null}if(!l.ok){h((null==n?void 0:n.error)||"Update failed.");return}p(!1),y()},w=async()=>{let e=await fetch("/api/problems/".concat(i.id,"/solve"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userKey:o})}),l=null;try{l=await e.json()}catch(e){l=null}if(!e.ok){h((null==l?void 0:l.message)||(null==l?void 0:l.error)||"Solve failed.");return}if(l.conflict){let e=l.conflictDetails;if(e){var n;h("".concat(l.message," Over by ").concat(e.overload," minutes. Consider removing ").concat(null===(n=e.mustTasks)||void 0===n?void 0:n.length," must tasks."))}else h(l.message)}else h("Solutions generated.")};return(0,t.useEffect)(()=>{y()},[o]),(0,s.jsxs)("div",{className:"stack",children:[(0,s.jsxs)("div",{className:"hero",children:[(0,s.jsx)("h1",{children:(null==r?void 0:r.title)||"Problem"}),(0,s.jsxs)("h2",{children:["Available ",null!==(n=null==r?void 0:null===(l=r.params)||void 0===l?void 0:l.availableMinutes)&&void 0!==n?n:"?"," minutes"]})]}),m?(0,s.jsx)("div",{className:"banner",children:m}):null,(0,s.jsxs)("section",{className:"panel stack",children:[(0,s.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,s.jsx)("strong",{children:"Tasks"}),(0,s.jsxs)("div",{className:"row",children:[(0,s.jsx)("button",{type:"button",className:"secondary",onClick:()=>p(!v),children:v?"Cancel edit":"Edit"}),(0,s.jsx)("button",{type:"button",onClick:w,children:"Generate options"})]})]}),v?(0,s.jsxs)("div",{className:"stack",children:[(0,s.jsxs)("label",{children:[(0,s.jsx)("small",{children:"Title"}),(0,s.jsx)("input",{value:b,onChange:e=>j(e.target.value)})]}),(0,s.jsxs)("label",{children:[(0,s.jsx)("small",{children:"Available minutes"}),(0,s.jsx)("input",{type:"number",min:15,value:x,onChange:e=>f(Number(e.target.value))})]}),(0,s.jsx)("button",{type:"button",className:"secondary",onClick:()=>{d(e=>[...e,{id:crypto.randomUUID(),label:"",duration_min:30,must:!1}])},children:"Add task"}),u.map((e,l)=>(0,s.jsxs)("div",{className:"grid-two",children:[(0,s.jsxs)("label",{children:[(0,s.jsx)("small",{children:"Label"}),(0,s.jsx)("input",{value:e.label,onChange:e=>g(l,"label",e.target.value)})]}),(0,s.jsxs)("label",{children:[(0,s.jsx)("small",{children:"Duration (min)"}),(0,s.jsx)("input",{type:"number",min:5,value:e.duration_min,onChange:e=>g(l,"duration_min",Number(e.target.value))})]}),(0,s.jsxs)("label",{children:[(0,s.jsx)("small",{children:"Must"}),(0,s.jsxs)("select",{value:e.must?"yes":"no",onChange:e=>g(l,"must","yes"===e.target.value),children:[(0,s.jsx)("option",{value:"no",children:"Optional"}),(0,s.jsx)("option",{value:"yes",children:"Must"})]})]}),(0,s.jsx)("button",{type:"button",className:"secondary",onClick:()=>N(l),children:"Remove"})]},e.id||l)),(0,s.jsx)("button",{type:"button",onClick:k,children:"Save changes"})]}):u.map(e=>(0,s.jsxs)("div",{className:"card",children:[(0,s.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,s.jsx)("strong",{children:e.label}),(0,s.jsxs)("span",{className:"pill",children:[e.duration_min," min"]})]}),(0,s.jsx)("div",{className:"row",children:e.must?(0,s.jsx)("span",{className:"pill",children:"Must"}):(0,s.jsx)("span",{className:"pill",children:"Optional"})})]},e.id))]})]})}},3323:function(e,l,n){"use strict";n.d(l,{Z:function(){return t}});var s=n(2265);function t(){let[e,l]=(0,s.useState)("");return(0,s.useEffect)(()=>{let e=window.localStorage.getItem("solvespace_user_key");if(e){l(e);return}let n=crypto.randomUUID();window.localStorage.setItem("solvespace_user_key",n),l(n)},[]),e}}},function(e){e.O(0,[971,23,744],function(){return e(e.s=7919)}),_N_E=e.O()}]);