(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[271],{7219:function(e,t,s){Promise.resolve().then(s.bind(s,2186))},2186:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return o},dynamic:function(){return i}});var n=s(8247),a=s(888),r=s(9644);let i="force-dynamic";function o(){let e=(0,r.N)(),[t,s]=(0,a.useState)([]),[i,o]=(0,a.useState)(""),[l,c]=(0,a.useState)(!1),[u,d]=(0,a.useState)(""),m=(0,a.useMemo)(()=>(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,t=new Date(e),s=t.getDay();return t.setDate(t.getDate()+((0===s?-6:1)-s)),t.setHours(0,0,0,0),t})(),[]);async function h(){let{data:t,error:n}=await e.from("weekly_mints").select("id,week_start,total_seconds,session_count,flow_count,drag_count,top_tags,created_at").order("week_start",{ascending:!1});if(n){o(n.message);return}s(t||[])}async function f(){c(!0);let n=m.toISOString().slice(0,10),{data:a,error:r}=await e.rpc("mint_week",{p_week_start:n});if(r){o(r.message),c(!1);return}s([a,...t.filter(e=>e.week_start!==a.week_start)]),c(!1)}return(0,a.useEffect)(()=>{e.auth.getSession().then(e=>{let{data:t}=e;t.session||(window.location.href="/login")})},[]),(0,a.useEffect)(()=>{h()},[]),(0,n.jsxs)("div",{className:"grid",children:[(0,n.jsxs)("div",{className:"card",children:[(0,n.jsx)("h2",{children:"Weekly mints"}),(0,n.jsx)("p",{className:"muted",children:"Generate weekly rollups of your sessions."}),(0,n.jsxs)("div",{className:"toolbar",style:{marginTop:12},children:[(0,n.jsx)("button",{className:"btn",onClick:f,disabled:l,children:l?"Minting...":"Mint this week"}),(0,n.jsxs)("span",{className:"badge",children:["Week of ",m.toLocaleDateString()]})]}),(0,n.jsx)("div",{className:"toolbar",style:{marginTop:12},children:(0,n.jsx)("input",{className:"input",placeholder:"Filter by tag",value:u,onChange:e=>d(e.target.value)})}),i&&(0,n.jsx)("p",{className:"muted",style:{marginTop:12},children:i})]}),0===t.length?(0,n.jsx)("div",{className:"card",children:(0,n.jsx)("p",{className:"muted",children:"No mints yet."})}):t.filter(e=>!u||(e.top_tags||[]).some(e=>e.tag.toLowerCase().includes(u.toLowerCase()))).map(e=>(0,n.jsxs)("a",{className:"card",href:"/mint/".concat(e.week_start),children:[(0,n.jsxs)("div",{className:"toolbar",style:{justifyContent:"space-between"},children:[(0,n.jsxs)("strong",{children:["Week of ",new Date(e.week_start).toLocaleDateString()]}),(0,n.jsxs)("span",{className:"badge",children:[Math.round(e.total_seconds/3600),"h"]})]}),(0,n.jsxs)("p",{className:"muted",children:["Sessions ",e.session_count," \xb7 Flow ",e.flow_count," \xb7 Drag ",e.drag_count]}),(e.top_tags||[]).length>0&&(0,n.jsx)("div",{className:"toolbar",style:{marginTop:8},children:e.top_tags.map(e=>(0,n.jsx)("span",{className:"badge",children:e.tag},e.tag))})]},e.id))]})}},9644:function(e,t,s){"use strict";s.d(t,{N:function(){return i}});var n=s(4286),a=s(461);let r=null;function i(){if(r)return r;let e=a.env.NEXT_PUBLIC_SUPABASE_URL||"http://localhost:54321",t=a.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"anon-key";return r=(0,n.eI)(e,t,{auth:{persistSession:!0,autoRefreshToken:!0}})}}},function(e){e.O(0,[775,501,539,744],function(){return e(e.s=7219)}),_N_E=e.O()}]);