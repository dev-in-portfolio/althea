"use strict";(()=>{var e={};e.id=818,e.ids=[818],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8815:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>b,patchFetch:()=>A,requestAsyncStorage:()=>c,routeModule:()=>m,serverHooks:()=>R,staticGenerationAsyncStorage:()=>y});var s={};t.r(s),t.d(s,{GET:()=>d,POST:()=>l,runtime:()=>p});var a=t(9303),n=t(8716),i=t(670),o=t(7070),u=t(1103);let p="nodejs";async function l(e){let r=await e.json(),t=String(r.userKey||""),s=String(r.title||"Untitled problem").trim().slice(0,120),a=Number(r.availableMinutes||0),n=Array.isArray(r.tasks)?r.tasks.slice(0,50):[];if(!t)return o.NextResponse.json({error:"userKey required"},{status:400});if(!a||a<=0||a>1440)return o.NextResponse.json({error:"available minutes must be > 0"},{status:400});let i=(0,u.M)(),p=await i.connect();try{await p.query("BEGIN");let e=crypto.randomUUID();for(let r of(await p.query("INSERT INTO problems (id, user_key, title, params) VALUES ($1, $2, $3, $4)",[e,t,s,{availableMinutes:a}]),n)){let s=Number(r.duration_min||0);!s||s<=0||s>480||await p.query("INSERT INTO tasks (id, problem_id, user_key, label, duration_min, must, constraints) VALUES ($1, $2, $3, $4, $5, $6, $7)",[crypto.randomUUID(),e,t,String(r.label||"").slice(0,140),s,!!r.must,r.constraints||null])}return await p.query("COMMIT"),o.NextResponse.json({id:e})}catch{return await p.query("ROLLBACK"),o.NextResponse.json({error:"failed"},{status:500})}finally{p.release()}}async function d(e){let{searchParams:r}=new URL(e.url),t=String(r.get("userKey")||"");if(!t)return o.NextResponse.json({error:"userKey required"},{status:400});let s=(0,u.M)(),{rows:a}=await s.query(`
    SELECT p.id, p.title, p.params, p.created_at,
      COUNT(t.id) AS task_count
    FROM problems p
    LEFT JOIN tasks t ON p.id = t.problem_id AND p.user_key = t.user_key
    WHERE p.user_key = $1
    GROUP BY p.id
    ORDER BY p.created_at DESC
  `,[t]);return o.NextResponse.json({problems:a})}let m=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/problems/route",pathname:"/api/problems",filename:"route",bundlePath:"app/api/problems/route"},resolvedPagePath:"/root/althea/app/api/problems/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:c,staticGenerationAsyncStorage:y,serverHooks:R}=m,b="/api/problems/route";function A(){return(0,i.patchFetch)({serverHooks:R,staticGenerationAsyncStorage:y})}},1103:(e,r,t)=>{t.d(r,{M:()=>n});let s=require("pg"),a=null;function n(){if(!a){if(!process.env.DATABASE_URL)throw Error("DATABASE_URL is not set");a=new s.Pool({connectionString:process.env.DATABASE_URL,max:5})}return a}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[948,972],()=>t(8815));module.exports=s})();