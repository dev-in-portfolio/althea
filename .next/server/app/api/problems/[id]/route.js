"use strict";(()=>{var e={};e.id=460,e.ids=[460],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5765:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>A,patchFetch:()=>w,requestAsyncStorage:()=>y,routeModule:()=>m,serverHooks:()=>R,staticGenerationAsyncStorage:()=>c});var s={};t.r(s),t.d(s,{DELETE:()=>d,GET:()=>p,PUT:()=>E,runtime:()=>l});var a=t(9303),i=t(8716),n=t(670),o=t(7070),u=t(1103);let l="nodejs";async function p(e,{params:r}){let{searchParams:t}=new URL(e.url),s=String(t.get("userKey")||""),a=r.id;if(!s)return o.NextResponse.json({error:"userKey required"},{status:400});let i=(0,u.M)(),n=await i.query("SELECT id, title, params, created_at FROM problems WHERE id = $1 AND user_key = $2",[a,s]);if(!n.rows.length)return o.NextResponse.json({error:"not found"},{status:404});let l=await i.query("SELECT id, label, duration_min, must, constraints FROM tasks WHERE problem_id = $1 AND user_key = $2 ORDER BY created_at ASC",[a,s]);return o.NextResponse.json({problem:n.rows[0],tasks:l.rows})}async function d(e,{params:r}){let{searchParams:t}=new URL(e.url),s=String(t.get("userKey")||""),a=r.id;if(!s)return o.NextResponse.json({error:"userKey required"},{status:400});let i=(0,u.M)(),n=await i.connect();try{return await n.query("BEGIN"),await n.query("DELETE FROM solutions WHERE problem_id = $1 AND user_key = $2",[a,s]),await n.query("DELETE FROM tasks WHERE problem_id = $1 AND user_key = $2",[a,s]),await n.query("DELETE FROM problems WHERE id = $1 AND user_key = $2",[a,s]),await n.query("COMMIT"),o.NextResponse.json({deleted:!0})}catch{return await n.query("ROLLBACK"),o.NextResponse.json({error:"failed"},{status:500})}finally{n.release()}}async function E(e,{params:r}){let t=await e.json(),s=String(t.userKey||""),a=r.id,i=String(t.title||"Untitled problem").trim().slice(0,120),n=Number(t.availableMinutes||0),l=Array.isArray(t.tasks)?t.tasks:[];if(!s)return o.NextResponse.json({error:"userKey required"},{status:400});if(!n||n<=0||n>1440)return o.NextResponse.json({error:"available minutes must be 1-1440"},{status:400});let p=(0,u.M)(),d=await p.connect();try{for(let e of(await d.query("BEGIN"),await d.query("UPDATE problems SET title = $1, params = $2 WHERE id = $3 AND user_key = $4",[i,{availableMinutes:n},a,s]),await d.query("DELETE FROM tasks WHERE problem_id = $1 AND user_key = $2",[a,s]),l)){let r=Number(e.duration_min||0);!r||r<=0||r>480||await d.query("INSERT INTO tasks (id, problem_id, user_key, label, duration_min, must, constraints) VALUES ($1, $2, $3, $4, $5, $6, $7)",[crypto.randomUUID(),a,s,String(e.label||"").slice(0,140),r,!!e.must,e.constraints||null])}return await d.query("COMMIT"),o.NextResponse.json({ok:!0})}catch{return await d.query("ROLLBACK"),o.NextResponse.json({error:"failed"},{status:500})}finally{d.release()}}let m=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/problems/[id]/route",pathname:"/api/problems/[id]",filename:"route",bundlePath:"app/api/problems/[id]/route"},resolvedPagePath:"/root/althea/app/api/problems/[id]/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:y,staticGenerationAsyncStorage:c,serverHooks:R}=m,A="/api/problems/[id]/route";function w(){return(0,n.patchFetch)({serverHooks:R,staticGenerationAsyncStorage:c})}},1103:(e,r,t)=>{t.d(r,{M:()=>i});let s=require("pg"),a=null;function i(){if(!a){if(!process.env.DATABASE_URL)throw Error("DATABASE_URL is not set");a=new s.Pool({connectionString:process.env.DATABASE_URL,max:5})}return a}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[948,972],()=>t(5765));module.exports=s})();